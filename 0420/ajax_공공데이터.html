<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <!-- 버튼 만들고 ajax로 공공데이터 가져오기 가져온 정보 표시한다.
        날짜, 권역, 측정소 명 추가로 받기 -->
        <input type="button" id="btn1" value="가져오기">
    
    <div id="info">
        <style>
            th,td{
                border: 1px solid grey;
                padding: 10px;
            }
        </style>
        <table>
            <thead>
                <tr>
                <th>항목</th>
                <th>내용</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="2">내용이 없습니다.</td>
                </tr>
     <!--            <tr>
                    <td>미세먼지</td>
                    <td>22.0</td>
                </tr>
                <tr>
                    <td>미세먼지</td>
                    <td>22.0</td>
                </tr> -->
            </tbody>
        </table>
    </div>
    <script>
        // 인증키 : "53526648466c75633733686b534766"
        // "http://openapi.seoul.go.kr:8088/53526648466c75633733686b534766/json/DailyAverageCityAir/1/5/20230420/서남권" + "/영등포구";
        
        let btn1 = document.querySelector("#btn1");
        btn1.addEventListener("click", function(){  //////////
            // ajax 객체 생성
            const xhr = new XMLHttpRequest();   // 준비시킴
            
            // 보낼 준비
            // let url ="http://openapi.seoul.go.kr:8088/53526648466c75633733686b534766/json/DailyAverageCityAir/1/5/20130306/서북권/은평구";  주소지정이 잘못된 것?
            //xhr.responseType = 'json'
            xhr.open('GET', 'http://openapi.seoul.go.kr:8088/53526648466c75633733686b534766/json/DailyAverageCityAir/1/5/20130306/서북권/은평구'); // url로 부르면 안 들어온다.
            // 실행을 지시. 단 언제 끝날지 모름
            xhr.send();
            // 다녀오는것이 끝났을 때, : 응답 이후
            xhr.onload = function(){
                console.log(xhr.responseText);
                
      
               /*  let a = {
                    "key" :"value",
                    "key1" :"value1",
                    "key3" :[1,2,3]
                }
                // 가져오는 방법
                a.key1      // value1
                a["key1"]   // value1
                a["key4"]   // value1


                // 없으면 추가하고 있으면 덮어쓴다.
                a.key2 = "abc"
 */
                try
                {
                    let json_data = JSON.parse(xhr.responseText);
                    //console.log(json_data);   
                    let PM10 = json_data.DailyAverageCityAir.row[0].PM10
                    let PM25 = json_data.DailyAverageCityAir.row[0].PM25

                    let html = "";
                    html += '<tr>';
                    html += '   <td>미세먼지</td>';
                    html += '   <td>'+PM10+'</td>';
                    html += '</tr>';
                    html += '<tr>';
                    html += '   <td>미세먼지</td>';
                    html += '   <td>'+PM25+'</td>';
                    html += '</tr>';
                    html += '</tr>';
           

                    document.querySelector("tbody").innerHTML =html;

                } catch(error){
                    console.error(error)
                }                
            }
        })

    </script>
</body>
</html>